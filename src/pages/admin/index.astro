---
export const prerender = false;

import { verifySession, getSessionFromRequest } from "../../lib/admin-auth";
import { getSiteConfig } from "../../lib/supabase";

const token = getSessionFromRequest(Astro.request);
if (!(await verifySession(token))) {
  return Astro.redirect("/admin/login");
}

const config = await getSiteConfig();
const isConfigured = config?.bubbleApiUrl && config?.bubbleContentTable;

if (isConfigured) {
  return Astro.redirect("/admin/articles");
} else {
  return Astro.redirect("/admin/onboarding");
}
---
