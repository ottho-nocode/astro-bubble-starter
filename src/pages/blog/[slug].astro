---
import Post from "../../layouts/Post.astro";
import { getPosts, getPostBySlug } from "../../lib/bubble";

export async function getStaticPaths() {
  let posts: Awaited<ReturnType<typeof getPosts>> = [];
  try {
    posts = await getPosts();
  } catch {
    return [];
  }

  return posts
    .filter((post) => post.slug)
    .map((post) => ({
      params: { slug: post.slug },
    }));
}

const { slug } = Astro.params;
const post = await getPostBySlug(slug!);

if (!post) {
  return Astro.redirect("/blog");
}
---

<Post
  title={post.title}
  description={post.excerpt}
  coverImage={post.cover_image}
  date={post.date}
  author={post.author}
  category={post.category}
>
  <Fragment set:html={post.content} />
</Post>
