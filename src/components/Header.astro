---
import { getLandingConfig } from "../lib/landing-config";

interface Props {
  name: string;
  logo?: string;
}

const { name, logo } = Astro.props;
const cfg = getLandingConfig();
const hdr = cfg.header;

if (!hdr.visible) return;

const logoUrl = logo
  ? logo.startsWith("//")
    ? `https:${logo}`
    : logo
  : "";

const navLinks = [
  { label: "Accueil", href: "/" },
  { label: "Blog", href: "/blog" },
];

const firstLetter = name.charAt(0).toUpperCase();
const scrollBg = hdr.scrollBgColor;
---

<header class="fixed top-0 left-0 w-full z-50 transition-all duration-300" id="site-header" data-scroll-bg={scrollBg}>
  <nav class="mx-auto max-w-6xl flex items-center justify-between px-6 py-4">
    <a href="/" class="flex items-center gap-2.5 group">
      {logoUrl ? (
        <img src={logoUrl} alt={`Logo ${name}`} class="h-9 w-auto max-w-[120px] object-contain rounded-lg" loading="eager" />
      ) : (
        <div class="relative">
          <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-primary-500 to-primary-700 flex items-center justify-center shadow-lg shadow-primary-600/25 group-hover:shadow-primary-600/40 transition-shadow">
            <span class="text-white font-heading font-extrabold text-lg">{firstLetter}</span>
          </div>
        </div>
      )}
      <span class="text-xl font-heading font-bold" style={`color:${hdr.nameColor};`}>{name}</span>
    </a>

    <div class="hidden lg:flex items-center gap-1">
      {navLinks.map((link) => (
        <a
          href={link.href}
          class="header-nav-link px-4 py-2 rounded-lg text-sm font-medium transition-colors duration-200"
          style={`color:${hdr.linkColor};`}
        >
          {link.label}
        </a>
      ))}
    </div>

    <button
      id="mobile-menu-btn"
      class="lg:hidden p-2 transition-colors"
      style={`color:${hdr.linkColor};`}
      aria-label="Ouvrir le menu"
      aria-expanded="false"
    >
      <svg class="w-6 h-6" id="hamburger-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <svg class="w-6 h-6 hidden" id="close-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </nav>

  <div id="mobile-menu" class="hidden lg:hidden bg-white/98 backdrop-blur-xl border-t border-gray-200/60">
    <div class="px-6 py-6 space-y-2">
      {navLinks.map((link) => (
        <a href={link.href} class="block font-medium text-base py-3 px-3 rounded-lg hover:bg-gray-50 transition-colors duration-200" style={`color:${hdr.linkColor};`}>
          {link.label}
        </a>
      ))}
    </div>
  </div>
</header>

<style define:vars={{ linkHoverColor: hdr.linkHoverColor }}>
  .header-nav-link:hover {
    color: var(--linkHoverColor) !important;
    background: rgba(0,0,0,0.04);
  }
</style>

<script>
  const btn = document.getElementById("mobile-menu-btn");
  const menu = document.getElementById("mobile-menu");
  const hamburger = document.getElementById("hamburger-icon");
  const close = document.getElementById("close-icon");
  btn?.addEventListener("click", () => {
    const isOpen = !menu?.classList.contains("hidden");
    menu?.classList.toggle("hidden");
    hamburger?.classList.toggle("hidden");
    close?.classList.toggle("hidden");
    btn.setAttribute("aria-expanded", String(!isOpen));
  });

  const header = document.getElementById("site-header");
  const scrollBg = header?.dataset.scrollBg || "rgba(250,250,248,0.8)";
  window.addEventListener("scroll", () => {
    if (window.scrollY > 50) {
      header!.style.background = scrollBg;
      header?.classList.add("backdrop-blur-xl", "border-b", "border-gray-200/60", "shadow-sm");
    } else {
      header!.style.background = "";
      header?.classList.remove("backdrop-blur-xl", "border-b", "border-gray-200/60", "shadow-sm");
    }
  });
</script>
